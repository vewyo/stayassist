version: "3.1"

intents:
  - user_intent_greet:
      description: >
        The guest greets the assistant or generally asks for help from StayAssist.
  - user_intent_book_room:
      description: >
        The guest wants to book or reserve a room, provide stay details, or continue the booking form.
  - user_intent_cancel_booking:
      description: >
        The guest wants to cancel an existing booking and may provide a booking number.
  - user_intent_facility_information:
      description: >
        The guest asks about room prices, facilities, pool/parking, meal times, or gym hours at StayAssist.
  - user_intent_clarification:
      description: >
        The guest indicates they don't understand something, asks for clarification, or needs a simpler explanation.

slots:
  arrival_date:
    type: text
    mappings:
      - type: from_llm
        prompt: |
          Extract ONLY a valid arrival date from the user's message.
          The user is being asked for their arrival date.

          CRITICAL VALIDATION RULES - return null if ANY of these apply:
          - February can only have days 1-28 (or 29 in leap years). "30 february", "56 february" = null
          - Months with 30 days (Apr, Jun, Sep, Nov) cannot have day 31. "31 april" = null
          - No month can have a day greater than 31. "45 december", "99 january" = null
          - Day must be a positive number between 1-31. "0 march", "-5 june" = null
          - Only a month name without a day is NOT a complete date. "December" alone = null
          - Gibberish or non-date text = null

          ONLY extract if the date is actually valid and exists in the calendar.
          If valid, return the date in format "DD Month YYYY" or "DD/MM/YYYY".
          If invalid or missing, return null.
  nights:
    type: text
    mappings:
      - type: from_llm
        prompt: |
          Extract ONLY the number of nights from the user's message.
          The user is being asked "How many nights would you like to stay?"
          - Extract numbers like "1", "2", "three", "one night" → extract the number
          - If the message contains a date or month name (like "December", "66 december"), that is NOT an answer to "how many nights" - return null.
          - If the message is clearly not a number of nights (like "no", "I don't know", dates), return null.
          - Only return a number between 1 and 365, or null if no valid number of nights can be extracted.
          Return only the number as text (e.g., "1", "2", "3"), or null.
  rooms:
    type: text
    mappings:
      - type: from_llm
        prompt: |
          Extract ONLY the number of rooms from the user's message.
          The user is being asked "How many rooms should I reserve for you?"
          - Extract numbers like "1", "2", "three", "one room" → extract the number
          - If the message contains a date or month name, that is NOT an answer to "how many rooms" - return null.
          - If the message is clearly not a number of rooms (like "no", "I don't know"), return null.
          - Only return a number between 1 and 10, or null if no valid number of rooms can be extracted.
          Return only the number as text (e.g., "1", "2"), or null.
  guests:
    type: text
    mappings:
      - type: from_llm
        prompt: |
          Extract ONLY the number of guests from the user's message.
          The user is being asked "How many guests will be staying?"
          - Extract numbers like "1", "2", "three", "two guests" → extract the number
          - If the message contains a date or month name, that is NOT an answer to "how many guests" - return null.
          - If the message is clearly not a number of guests (like "no", "I don't know"), return null.
          - Only return a number between 1 and 20, or null if no valid number of guests can be extracted.
          Return only the number as text (e.g., "1", "2"), or null.
  payment_option:
    type: text
    mappings:
      - type: from_llm
  email:
    type: text
    mappings:
      - type: from_llm
  first_name:
    type: text
    mappings:
      - type: from_llm
  last_name:
    type: text
    mappings:
      - type: from_llm
  payment_confirmation:
    type: text
    influence_conversation: false
    mappings:
      - type: from_llm
  booking_number:
    type: text
    mappings:
      - type: from_llm
  facility_topic:
    type: text
    mappings:
      - type: from_llm
  booking_reference:
    type: text
    influence_conversation: false
    mappings:
      - type: custom
  date_valid:
    type: bool
    initial_value: false
    mappings:
      - type: custom

responses:
  utter_greet_and_offer_help:
    - text: "Welcome to StayAssist. How can I assist you today?"
      metadata:
        rephrase: False

  utter_ask_arrival_date:
    - text: "What is your desired arrival date?"

  utter_ask_nights:
    - text: "How many nights would you like to stay?"

  utter_ask_rooms:
    - text: "How many rooms should I reserve for you?"

  utter_ask_guests:
    - text: "How many guests will be staying?"

  utter_ask_payment_option:
    - text: "Would you like to pay at the front desk or complete the payment online now?"

  utter_ask_email:
    - text: "Could you share the email address for the reservation confirmation?"

  utter_ask_first_name:
    - text: "What's the first name to put on the reservation?"

  utter_ask_last_name:
    - text: "And the last name?"

  utter_ask_payment_confirmation:
    - text: "Let me know once the payment is completed so I can finalize the booking."

  utter_ask_booking_number:
    - text: "Please provide the booking number you would like me to cancel."

  utter_ask_facility_topic:
    - text: "Which facility or room detail would you like to know more about (pool, parking, meals, rooms, suite, gym)?"

  utter_ask_clarification:
    - text: "I'm here to help! What would you like me to explain in a simpler way? I can break it down step by step."

  utter_free_chitchat_response:
    - text: "placeholder"
      metadata:
        rephrase: True
        rephrase_prompt: |
          The following is a conversation with an AI assistant built with Rasa.
          The assistant represents StayAssist, a single-location hotel in Amsterdam.
          The assistant helps with room bookings, payments at the desk, online payments, cancellations using booking numbers, and facility questions (pool hours, parking fees, breakfast/lunch/dinner times, gym availability, and room amenities/prices).
          The assistant never asks the guest which city or neighborhood they prefer, because there is only one property location.
          The assistant is warm, concise, and confident about the hotel offerings.
          
          CRITICAL: When greeting users, say "Welcome to StayAssist. How can I assist you today?" - DO NOT add "Amsterdam" to the greeting message. Keep greetings simple and friendly.
          
          CRITICAL ERROR HANDLING RULES:
          1. Recognize and auto-correct spelling mistakes (e.g., "februay" → "February")
          2. Convert written numbers to digits (e.g., "one" → 1, "two guests" → 2)
          3. Validate dates and check if they exist (reject "44 February" gracefully)
          4. Detect illogical numbers (negative amounts, zero people) and ask for correction
          5. Understand chaotic or messy sentences and extract the intended meaning
          6. When input is wrong or invalid, explain what's wrong and immediately ask a clear new question with examples
          7. Never crash on incomprehensible input; always ask for clarification and provide examples of valid answers
          8. If the guest says they don't understand, automatically provide a clearer, simpler explanation step by step, avoiding confusing terms
          
          The user is making small talk, and the assistant should respond, keeping things light.
          Context / previous conversation with the user:
          {{history}}
          {{current_input}}
          Suggested AI Response:

actions:
  - action_confirm_reservation_hold
  - action_generate_booking_number
  - action_send_payment_link
  - action_confirm_payment_received
  - action_cancel_booking
  - action_answer_facility_question
  - action_validate_date
  - action_validate_nights
  - action_validate_rooms
  - action_validate_guests
  - action_clarify_explanation